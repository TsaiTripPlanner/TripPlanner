# 🌍 TripPlanner 旅遊規劃助手 - 功能與邏輯清單

這份文件記錄了本專案的核心功能與開發邏輯，作為未來維護與功能擴充的依據。

---

## 🏗️ 系統架構
- **前端框架**: React 19 (Hooks)
- **樣式工具**: Tailwind CSS
- **後端資料庫**: Firebase Firestore (即時同步)
- **身份驗證**: 行程通行碼機制 (Firebase Auth 匿名與 Email 模擬)
- **離線支援**: PWA (Service Worker) & Firestore 離線快取

---

## 📍 1. 行程規劃 (Itinerary)
- **多天數管理**: 支援動態天數切換。
- **排序邏輯 (重要)**: 
  1. 優先依照 `startTime` (時間) 排序。
  2. 若無時間或時間相同，則依照 `order` (手動拖拽順序) 排序。
- **拖拽功能**: 整合 `@hello-pangea/dnd` 實現活動項目手動排序。
- **自動時長計算**: 輸入開始與結束時間後，自動計算並顯示持續小時/分鐘。
- **編輯功能**: 支援修改標題、類型、時間、詳細說明與上傳景點圖片。

## 🎒 2. 清單管理 (Packing List)
- **分類系統**: 支援自定義類別 (例：電子產品、藥品)。
- **跨行程匯入**: 
  - 可從其他已存在的行程中匯入完整清單。
  - **排序保護**: 匯入時會自動在 `createdAt` 加入時間間隔，確保顯示順序與原始行程一致。
- **樂觀更新 (Optimistic UI)**: 點擊打勾時畫面立即反應，同步在背景寫入 Firebase。

## 💰 3. 旅行費用 (Budget)
- **多幣別支援**: TWD, JPY, KRW, USD 等常用幣別。
- **費用計算**:
  - **👤 單人模式**: 輸入單人金額，系統自動乘上旅伴人數計算總額。
  - **👥 總額模式**: 輸入整團花費，系統自動除以人數計算人均。
- **每日彙整**: 依天數分群顯示支出，並在頂部顯示該行程所有幣別的總結。

## 📖 4. 參考資料庫 (Reference)
- **分類管理**: 分為「景點介紹」與「交通/攻略」。
- **自動抓取**: 輸入網址後，可透過 API 抓取網頁標題、預覽圖與描述 (Metadata)。
- **圖片儲存**: 整合 Cloudinary API 實現圖片上傳。

---

## 🎨 5. 主題系統 (Theme)
- **莫蘭迪 (Morandi)**: 偏向冷色調、穩重的灰藍色系。
- **無印簡約 (Muji)**: 溫暖的木質調、米色與深啡色系。
- **切換機制**: 透過 `ThemeProvider` 全域管理顏色變數。

---

## ⚠️ 開發注意事項 (防錯指引)
1. **Firebase 路徑**: 所有資料儲存在 `artifacts/my-trip-app-v18-burger-icon/users/{userId}/itineraries` 下。
2. **新增活動**: 在 `useActivities.js` 中新增活動時，必須確保賦予正確的 `day` 索引。
3. **時間格式**: 時間字串統一採用 24 小時制 (`HH:mm`)，以利於字串比較排序。
4. **圖片上傳**: 需確認 Cloudinary 的 `UPLOAD_PRESET` 是否正確設定。

---

## ✅ 測試 Checkbox (每次 Commit 前必測)
- [ ] 切換天數，活動列表是否正確更新？
- [ ] 補填活動時間後，卡片是否自動重新排序？
- [ ] 在「清單」分頁，匯入其他行程的資料是否排序正確？
- [ ] 費用計算的「單人/總額」切換是否正確連動？
- [ ] 離線狀態下修改資料，恢復連線後是否自動同步？